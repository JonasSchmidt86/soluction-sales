<div class="card mt-3">
  <div class="card-header text-center bg-primary text-white">
    <h4>Orçamentos</h4>
  </div>
  <div class="card-body">
    <div class="mb-3">
      <%= link_to 'Novo Orçamento', new_collaborators_backoffice_orcamento_path, class: 'btn btn-primary' %>
    </div>
    <div class="table-responsive">
      <table id="orcamentos-table" class="table table-striped table-hover table-bordered table-sm">
        <thead>
          <tr>
            <th>Código</th>
            <th>Cliente</th>
            <th style="text-align: center;">Data</th>
            <th style="text-align: center;">Validade</th>
            <th style="text-align: center;">Valor Total</th>
            <th style="width: 100px;">Status</th>
            <th style="text-align: center;">Ações</th>
          </tr>
        </thead>
        <tbody>
          <% @orcamentos.each do |orcamento| %>
            <tr>
              <td class="col-acoes" style="text-align: center;"><%= orcamento.cod_orcamento %></td>
              <td><%= orcamento.pessoa.nome %></td>
              <td class="col-acoes"><%= l(orcamento.data_orcamento, format: :default) %></td>
              <td class="col-acoes"><%= orcamento.data_validade ? l(orcamento.data_validade) : '-' %></td>
              <td class="col-acoes"><%= "R$ #{number_to_currency(orcamento.valortotal, separator: ",", delimiter: "", unit:"")}" %></td>
              <td>
                <% case orcamento.status %>
                <% when 'pendente' %>
                  <span class="badge bg-warning">Pendente</span>
                <% when 'aprovado' %>
                  <span class="badge bg-success">Aprovado</span>
                <% when 'convertido' %>
                  <span class="badge bg-info">Convertido</span>
                <% when 'rejeitado' %>
                  <span class="badge bg-danger">Rejeitado</span>
                <% end %>
              </td>
              <td class="col-acoes">
                <%= link_to collaborators_backoffice_orcamento_path(orcamento),
                    class: 'btn btn-info btn-sm btn-acao',
                    title: 'Visualizar' do %>
                  <i class="fa fa-eye"></i>
                <% end %>
                <% unless orcamento.convertido? %>
                  <%= link_to edit_collaborators_backoffice_orcamento_path(orcamento),
                      class: 'btn btn-warning btn-sm btn-acao',
                      title: 'Editar' do %>
                    <i class="fa fa-edit"></i>
                  <% end %>
                  <%= link_to collaborators_backoffice_orcamento_path(orcamento),
                      method: :delete,
                      data: { confirm: 'Tem certeza?' },
                      class: 'btn btn-danger btn-sm btn-acao',
                      title: 'Excluir' do %>
                    <i class="fa fa-trash-can"></i>
                  <% end %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="mt-3">
      <%= paginate @orcamentos %>
    </div>
  </div>
</div>
<style>
  /* Ajuste da coluna de ações no index */
  table {
    table-layout: auto;
  }

  th.col-acoes,
  td.col-acoes {
    text-align: right;
    white-space: nowrap;
    width: 1%;
    padding-left: 18px;
    padding-right: 18px;
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    $('#orcamentos-table').DataTable({
      "paging": false,  // Desabilita a paginação
      "searching": false, // Permite a pesquisa na tabela (opcional)
      "ordering": true,  // Habilita ordenação nas colunas (opcional)
      "info": false}); // Habilita ordenação nas colunas (opcional)
  });
</script>