<div class="card mt-3">
  <div class="card-header text-center bg-primary text-white">
    <h4>Pagamentos de Lançamentos Provisionados</h4>
  </div>
  <div class="card-body">
    <%= form_with(url: pagamentos_collaborators_backoffice_lancamentosdiversos_path, method: :get, local: true, class: "dataTable-search mb-2") do |form| %>
      <div class="container-fluid">
        <div class="row g-2 align-items-center">
          <!-- Descrição -->
          <div class="col-auto">
            <%= form.text_field :descricao_cont, value: params[:descricao_cont], class: "form-control form-control-md text" , placeholder: "Descrição" %>
          </div>
          <!-- Histórico -->
          <div class="col-auto">
            <div class="col-auto">
              <%= select_tag(:cod_historico, 
                      options_from_collection_for_select(
                      Tiposhistoricoscaixa.where(ativo: true).order(:cod_tphitorico), 
                      "cod_tphitorico", "descricao", params[:cod_historico]), include_blank: "Histórico",
                      class: "form-select form-select-md", style: "width: 150px;" ) %>
            </div>
          </div>
          <!-- Data Inicial -->
          <div class="col-auto">
            <%= form.text_field :data_inicial, value: params[:data_inicial], class: "form-control form-control-md datepicker fallback", placeholder: "Data Inicial", style: "min-width: 115px; max-width: 115px;" %>
          </div>
          <!-- Data Final -->
          <div class="col-auto">
            <%= form.text_field :data_final, value: params[:data_final], class: "form-control form-control-md datepicker fallback", placeholder: "Data Final", style: "min-width: 115px; max-width: 115px;" %>
          </div>
          <!-- Botão de buscar -->
          <div class="col-auto d-grid" style="width: 80px;">
            <%= form.submit "Buscar", class: "btn btn-success btn-md w-100" %>
          </div>
        </div>
      </div>
    <% end %>
    <div class="table-responsive">
      <table id="lancamentosdiversos-table" class="table table-striped table-hover table-bordered table-sm">
        <thead>
          <tr>
            <th>Descrição</th>
            <th>Data de Início</th>
            <th>Histórico</th>
            <th>Valor</th>
            <th style="text-align: center;">Ações</th>
          </tr>
        </thead>
        <tbody>
          <% @lancamentos_diversos.each do |lancamento| %>
            <tr>
              <td><%= lancamento.descricao %></td>
              <td data-order="<%= lancamento.datainicio %>"><%= l(lancamento.datainicio) if lancamento.datainicio %></td>
              <td><%= lancamento.historico&.descricao %></td>
              <td class="text-end">
                <%= number_to_currency(
                    lancamento.valor,
                    unit: "R$",
                    separator: ",",
                    delimiter: ".",
                    precision: 2,
                    negative_format: "(%u %n)"
                ) %>
              </td>
              <td class="col-acoes">
                <%= link_to '#',
                    class: 'btn btn-success btn-sm btn-acao',
                    title: 'Pagar',
                    data: { bs_toggle: 'modal', bs_target: "#paymentModal#{lancamento.id}"} do %>
                  <i class="fa fa-money-bill"></i> Pagar
                <% end %>
              </td>
              <%= render partial: 'collaborators_backoffice/lancamentosdiversos/shared/payment_modal', locals: { lancamento: lancamento, filtros: request.query_parameters } %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="mt-3">
      <%= paginate @lancamentos_diversos %>
    </div>
  </div>
</div>
<style>
  table {
    table-layout: auto;
  }

  th.col-acoes,
  td.col-acoes {
    text-align: right;
    white-space: nowrap;
    width: 1%;
    padding-left: 18px;
    padding-right: 18px;
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    $('#lancamentosdiversos-table').DataTable({
        paging: false,
        searching: false,
        ordering: true,
        info: false,
        columnDefs: [
            { targets: 2, type: 'date' }
        ]
    });
  });
</script>