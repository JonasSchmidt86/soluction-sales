<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Moveis Rosa Store</title>
        
        <%= csrf_meta_tags %>
        <%= csp_meta_tag %>

        <%= stylesheet_link_tag 'application' %>
        <%= stylesheet_link_tag 'collaborators_backoffice' %>

    </head>
    <body class="sb-nav-fixed bg-light">

        <nav class="d-flex justify-content-between mb-1 sb-topnav navbar-expand-lg navbar-light border bg-light hstack gap-3 ">
            
            <!-- Navbar Brand-->
            <div class="p-2 d-flex justify-content-start">
                <%= link_to (current_collaborator.empresa.nome unless current_collaborator.empresa.blank? ) , 
                    collaborators_backoffice_welcome_index_path, class: "bg-light border badge text-white bg-dark navbar-brand fs-4 "%>
            </div>

            <!-- Sidebar Toggle -->
            <button class="btn btn-link btn-sm order-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i class="fas fa-bars"></i></button>
            
            <!-- sidebar hora -->
            <div class="text-center">
                <a id="myId" class=" text-black hstack fs-5 ">Hora</a>
                <a> </a>
            </div>
                

            <!-- Navbar Menu -->
            <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
                <button type="button", class="btn btn-success btn-circle", data-bs-toggle="modal",
                    data-bs-target="#empresaModal", data-bs-whatever="passa para o modal" >

                    <i class="me-lg-5">
                    <% if !current_collaborator.empresa.nome.blank? %>
                        <%= current_collaborator.empresa.nome %>
                    <% end %>
                    </i>
                </button>
            </form>

            <!-- Navbar-->
            <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user fa-fw"></i>
                        <%= current_collaborator.funcionario.pessoa.nome %>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="#!">Settings</a></li>
                        <li><a class="dropdown-item" href="#!">Activity Log</a></li>
                        <li><hr class="dropdown-divider" /></li>
                        <li>
                            <a class="dropdown-item" href="#">
                                <%= link_to destroy_collaborator_session_path, class:"dropdown-item", method: :delete do %>
                                <i class="fa fa-power-off fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Sair
                                <% end %>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
            
        </nav>
        
        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sb-sidenav accordion sb-sidenav-light" id="sidenavAccordion">

                    <!-- Side bar right -->
                    <div class="sb-sidenav-menu bg-light">
                        <div class="nav">

                            <div class="profile clearfix d-flex justify-content-center">
                                    <%= link_to image_tag(avatar_url, style:"width: 120px; height: 120px;", id:"imgAvatarLg", class:"rounded mx-auto d-block rounded-5"), 
                                                        '#', "data-bs-toggle":"modal", "data-bs-target":"#avatarModal" %>
                            </div>

                            <div class="sb-sidenav-menu-heading">Menus</div>
                                <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapseCads" aria-expanded="false" aria-controls="collapseCads">
                                    <div class="sb-nav-link-icon"><i class="fa-solid fa-money-check-dollar fa-flip" style="--fa-animation-duration: 3s;" ></i></div>
                                        Cadastros
                                    <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                                </a>
                                <div class="collapse" id="collapseCads" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
                                    <nav class="sb-sidenav-menu-nested nav">

                                        <li>
                                            <%= link_to collaborators_backoffice_welcome_index_path, class:"nav-link" do %>
                                                <i class="fa fa-dashboard fa-fw"></i> Dashboard
                                            <% end %>
                                        </li>
                                        <li>
                                            <%= link_to collaborators_backoffice_caixa_index_path, class:"nav-link" do %>
                                                <i class="fa fa-dashboard fa-fw"></i> Caixa
                                            <% end %>
                                        </li>

                                        <li>
                                            <%= link_to collaborators_backoffice_collaborators_path, class:"nav-link" do %>
                                                <i class="fa fa-users fa-fw"></i> Colaboradores
                                            <% end %>
                                        </li>

                                    </nav>
                                </div>
                                <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapseOts" aria-expanded="false" aria-controls="collapseOts">
                                    <div class="sb-nav-link-icon">
                                        <i class="fa-solid fa-scroll fa-flip" style="--fa-flip-x: 1; --fa-flip-y: 0; --fa-animation-duration: 3s;" ></i>
                                    </div>
                                        Ots
                                    <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                                </a>
                                <div class="collapse" id="collapseOts" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
                                    <nav class="sb-sidenav-menu-nested nav">

                                        <a>
                                            <%= link_to new_collaborators_backoffice_venda_path, class:"nav-link" do %>
                                                Vendas
                                            <% end %>
                                        </a>
                                        <a>
                                            <%= link_to collaborators_backoffice_empresa_estoque_index_path, class:"nav-link" do %>
                                                Estoque
                                            <% end %>
                                        </a>
                                        <a>
                                            <%= link_to collaborators_backoffice_produtos_path, class:"nav-link" do %>
                                                Produtos
                                            <% end %>
                                        </a>
                                        <a>
                                            <%= link_to collaborators_backoffice_lembretes_path, class:"nav-link" do %>
                                                Lembretes
                                            <% end %>
                                        </a>
                                        <a>
                                            <%= link_to collaborators_backoffice_funcionarios_path, class:"nav-link" do %>
                                                Funcionario
                                            <% end %>
                                        </a>
                                        <a>
                                            <%= link_to collaborators_backoffice_contas_pag_rec_index_path, class:"nav-link" do %>
                                                Contas pagar/Receber
                                            <% end %>
                                        </a>
                                    </nav>
                                </div>

                                <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapseRels" aria-expanded="false" aria-controls="collapseRels">
                                    <div class="sb-nav-link-icon">
                                    <i class="fa-solid fa-search fa-flip" style="--fa-flip-x: 0; --fa-flip-y: 1; --fa-animation-duration: 3s;" ></i></div>
                                    Relatorios
                                    <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                                </a>
                                <div class="collapse" id="collapseRels" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
                                    <nav class="sb-sidenav-menu-nested nav">
                                        <a>
                                            <%= link_to collaborators_backoffice_report_sales_path, class:"nav-link" do %>
                                                Relatório de Vendas
                                            <% end %>
                                        </a>
                                        <a>
                                            <%= link_to collaborators_backoffice_report_put_box_index_path, class:"nav-link" do %>
                                                Lançamentos Caixa
                                            <% end %>
                                        </a>
                                    </nav>
                                </div>


                        </div>
                    </div>

                    <!--Fim Side bar right -->

                    <div class="sb-sidenav-footer">
                        <div class="small">Quem esta Logado:</div>
                        <%= current_collaborator.funcionario.usuario %>
                    </div>
                
                

                </nav>
            </div>

            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid px-4">
                        <%= yield %>
                    </div>
                </main>
            </div>

        
        </div>


        <%= javascript_include_tag 'application'%>
        <%= javascript_include_tag 'collaborators_backoffice' %>



        <%= render partial: 'layouts/shared/modal', locals: { action_message: 'Modal' } %>
        <!-- Modal -->
        <%= render partial: 'layouts/shared/empresa_modal', locals: { action_message: 'Modal' } %>

        

        <script>
            var div = document.getElementById("myId");

            // Adicionando ouvinte de clique
            div.addEventListener("click", function () {
                 div.innerHTML = "Boas Vendas =)";
            });

            // Criando um intervalo
            var interval = setInterval(function () {
                var date = new Date();
                div.innerHTML = date.toLocaleTimeString();
            }, 1000/* 1s */);


            <% if notice %>
                $.bootstrapGrowl('<%= notice %>', {
                    // ele: 'body', // which element to append to
                    type: 'success', // (null, 'info', 'danger', 'success')
                    offset: {from: 'top', amount: 55}, // 'top', or 'bottom'
                    align: 'center', // ('left', 'right', or 'center')
                    // width: 250, // (integer, or 'auto')
                    // delay: 4000, // Time while the message will be displayed. It's not equivalent to the *demo* timeOut!
                    allow_dismiss: false, // If true then will display a cross to close the popup.
                    stackup_spacing: 10 // spacing between consecutively stacked growls.
                });
            <% end %>


            document.addEventListener("keypress", function () { 
                console.log(event.key); // se eu clicar 'p' vai me retornar 'p' ao contrário do keycode que retorna o código da tecla
                if(event.keyCode == 13){ // 13 é o Enter
                    event.preventDefault();
                }
            });

            if( document.getElementById('text') != null ){
                // console.log("event.key")

                document.getElementById('text').addEventListener('keyup', (ev) => {
                    const input = ev.target;
                    input.value = input.value.toUpperCase();

                });
            // keyPress Enter não faz o submit
                document.getElementById('text').addEventListener("keypress", function () { 
                    // console.log(event.key); // se eu clicar 'p' vai me retornar 'p' ao contrário do keycode que retorna o código da tecla
                    if(event.keyCode == 13){ // 13 é o Enter
                        event.preventDefault();
                    }
                });
            }

            function formatarMoeda() {
                var elemento = document.getElementById('valor');
                var valor = elemento.value;

                console.log("Passou formatarMoeda!! ")

                valor = valor + '';
                valor = parseInt(valor.replace(/[\D]+/g, ''));
                valor = valor + '';
                valor = valor.replace(/([0-9]{2})$/g, ",$1");

                if (valor.length > 6) {
                    valor = valor.replace(/([0-9]{3}),([0-9]{2}$)/g, ".$1,$2");
                }
                elemento.value = valor;
                if(valor == 'NaN') elemento.value = '';
            };

            // para mascaras gem jquery-mask-pluguin
            $(document).ready(function(){
                $('.date').mask('00/00/0000');
                $('.time').mask('00:00:00');
                $('.date_time').mask('00/00/0000 00:00:00');
                $('.cep').mask('00000-000');
                $('.phone').mask('0000-0000');
                $('.phone_with_ddd').mask('(00) 0000-0000');
                $('.phone_us').mask('(000) 000-0000');
                $('.mixed').mask('AAA 000-S0S');
                $('.cpf').mask('000.000.000-00', {reverse: true});
                $('.cnpj').mask('00.000.000/0000-00', {reverse: true});
                $('.money').mask('000.000.000.000.000,00', {reverse: true});
                $('.money2').mask("#.##0,##", {reverse: true});
                $('.ip_address').mask('0ZZ.0ZZ.0ZZ.0ZZ', {
                    translation: {
                    'Z': {
                        pattern: /[0-9]/, optional: true
                    }
                    }
                });
                $('.ip_address').mask('099.099.099.099');
                $('.percent').mask('##0,00%', {reverse: true});
                $('.clear-if-not-match').mask("00/00/0000", {clearIfNotMatch: true});
                $('.placeholder').mask("00/00/0000", {placeholder: "__/__/____"});
                $('.fallback').mask("00r00r0000", {
                    translation: {
                        'r': {
                        pattern: /[\/]/,
                        fallback: '/'
                        },
                        placeholder: "__/__/____"
                    }
                    });
                $('.selectonfocus').mask("00/00/0000", {selectOnFocus: true});
            });

            
        </script>

            <%= javascript_tag do %>
                $(function() {
                $('.datepicker').datepicker();
                });
            <% end %>

    </body>
</html>


<%#

    criar uma tabela de log de usuario para gravar quando ele logar 
    ao logar no index grava o log e a empresa que ele conectou
    toda vez que ele logar buscar o log e ve qual a ultima empresa logada 
    cada alteração de empresa logada atualiza tabela log no banco ou encerra um log e cria outro log para

 %>