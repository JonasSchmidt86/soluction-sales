<!-- Hero Section com imagem de fundo -->
<section class="hero-section">
  <div class="container text-center">
    <h1 class="display-3 fw-bold mb-4">Móveis Rosa Store</h1>
    <p class="lead mb-5">Há 30 anos transformando casas em lares com móveis e decoração de qualidade</p>
    <a href="#equipe" class="btn btn-primary btn-lg">Fale Conosco</a>
  </div>
</section>
<!-- Sobre Nós Section -->
<section id="sobre" class="py-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-6 mb-4 mb-lg-0">
        <img src="/images/sobre_loja.jpeg" alt="Sobre Nós" class="img-fluid rounded shadow">
      </div>
      <div class="col-lg-6">
        <h2 class="section-title text-start">Sobre Nossa Empresa</h2>
        <p class="mb-4">Móveis Rosa Store é sinônimo de tradição, qualidade e bom gosto. Desde 1996, levamos móveis e decorações que transformam ambientes e realizam sonhos. <br>
          <br>
          São quase 30 anos de história, sempre com o compromisso de oferecer produtos de excelência e atendimento de confiança.
          Com seis lojas localizadas nas cidades de Toledo, Marechal Cândido Rondon, Nova Santa Rosa, Maripá, Porto Mendes e Assis, seguimos crescendo com você, valorizando cada detalhe que faz da sua casa um verdadeiro lar.</p>
        <div class="row mt-4">
          <div class="col-md-6 mb-3">
            <div class="d-flex align-items-center">
              <i class="fas fa-check-circle text-dark me-3 fs-4"></i>
              <div>
                <h5 class="mb-1">Qualidade</h5>
                <p class="mb-0 text-muted">Produtos de excelência</p>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="d-flex align-items-center">
              <i class="fas fa-headset text-dark me-3 fs-4"></i>
              <div>
                <h5 class="mb-1">Suporte</h5>
                <p class="mb-0 text-muted">Atendimento personalizado</p>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="d-flex align-items-center">
              <i class="fas fa-rocket text-dark me-3 fs-4"></i>
              <div>
                <h5 class="mb-1">Inovação</h5>
                <p class="mb-0 text-muted">Soluções modernas</p>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="d-flex align-items-center">
              <i class="fas fa-shield-alt text-dark me-3 fs-4"></i>
              <div>
                <h5 class="mb-1">Confiança</h5>
                <p class="mb-0 text-muted">Segurança garantida</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Missão, Visão e Valores Section -->
<section id="missao-visao-valores" class="py-5 bg-light">
  <div class="container">
    <h2 class="section-title text-center mb-5">Missão, Visão e Valores</h2>
    <div class="row mb-5">
      <div class="col-md-4 mb-4">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body text-center p-4">
            <div class="rounded-circle bg-dark text-white d-flex align-items-center justify-content-center mx-auto mb-4" style="width: 80px; height: 80px;">
              <i class="fas fa-bullseye fa-2x"></i>
            </div>
            <h3 class="card-title h4 mb-3 text-danger">Missão</h3>
            <p class="card-text">Transformar lares e vidas com móveis de qualidade, criando ambientes acolhedores que inspiram conforto e bem estar a família.</p>
          </div>
        </div>
      </div>
      <div class="col-md-4 mb-4">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body text-center p-4">
            <div class="rounded-circle bg-dark text-white d-flex align-items-center justify-content-center mx-auto mb-4" style="width: 80px; height: 80px;">
              <i class="fas fa-eye fa-2x"></i>
            </div>
            <h3 class="card-title h4 mb-3 text-danger">Visão</h3>
            <p class="card-text">Ser reconhecida como a melhor loja no segmento de móveis na região de atuação. Visão até 2027.</p>
            <p class="card-text"><strong>Entrega extraordinária:</strong> Proporcionar uma experiência única e encantadora ao cliente.</p>
          </div>
        </div>
      </div>
      <div class="col-md-4 mb-4">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body text-center p-4">
            <div class="rounded-circle bg-dark text-white d-flex align-items-center justify-content-center mx-auto mb-4" style="width: 80px; height: 80px;">
              <i class="fas fa-heart fa-2x"></i>
            </div>
            <h3 class="card-title h4 mb-3 text-danger">Valores</h3>
            <ul class="list-unstyled text-start">
              <li class="mb-2"><i class="fas fa-check-circle text-dark me-2"></i> <strong>Honestidade:</strong> Agir com base na verdade de forma ética, sem enganar ou omitir.</li>
              <li class="mb-2"><i class="fas fa-check-circle text-dark me-2"></i> <strong>Compromisso com o lar do cliente:</strong> Cada móvel entregue é parte de um sonho realizado.</li>
              <li class="mb-2"><i class="fas fa-check-circle text-dark me-2"></i> <strong>Espírito de colaboração:</strong> Trabalhar em equipe afim de buscar soluções e objetivos comuns.</li>
              <li class="mb-2"><i class="fas fa-check-circle text-dark me-2"></i> <strong>Respeito:</strong> Tratar ao próximo com dignidade, empatia e consideração.</li>
              <li class="mb-2"><i class="fas fa-check-circle text-dark me-2"></i> <strong>Fé:</strong> Acreditar no extraordinário.</li>
              <li class="mb-2"><i class="fas fa-check-circle text-dark me-2"></i> <strong>Desenvolvimento contínuo:</strong> Buscar constantemente o aprimoramento pessoal e profissional.</li>
              <li class="mb-2"><i class="fas fa-check-circle text-dark me-2"></i> <strong>Autorresponsabilidade:</strong> Assumir a responsabilidade pelas próprias ações, decisões e resultados.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Produtos Section -->
<section id="produtos" class="py-5 bg-light">
  <div class="container">
    <h2 class="section-title text-center">Nossos Produtos</h2>
    <p class="text-center mb-5">Conheça nossa linha exclusiva de móveis e decoração para sua casa</p>
    <div class="row justify-content-center">
      <% if @produtos.present? %>
        <% @produtos.each do |produto| %>
          <% produto.produto_imagens.group_by(&:cod_cor).each do |cod_cor, imagens| %>
            <div class="col-md-4 mb-4">
              <div class="card h-100">
                <div class="text-center p-3">
                  <% if imagens.count > 1 %>
                    <div id="carousel<%= produto.cod_produto %>_<%= cod_cor %>" class="carousel slide" data-bs-ride="carousel">
                      <div class="carousel-inner">
                        <% imagens.each_with_index do |imagem, index| %>
                          <div class="carousel-item <%= 'active' if index == 0 %>">
                            <%= image_tag(imagem.imagem.variant(resize_to_limit: [220, 180]),
                                  class: "rounded mx-auto d-block", 
                                  style: "max-width: 220px; height: 180px; object-fit: contain; cursor: pointer;",
                                  data: { images: imagens.map{|img| url_for(img.imagem)}.to_json.html_safe, index: index },
                                  ondblclick: "openImageModal(this)" 
                                ) %>
                          </div>
                        <% end %>
                      </div>
                      <button class="carousel-control-prev" type="button" data-bs-target="#carousel<%= produto.cod_produto %>_<%= cod_cor %>" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true" style="filter: invert(27%) sepia(51%) saturate(2878%) hue-rotate(346deg) brightness(104%) contrast(97%);"></span>
                      </button>
                      <button class="carousel-control-next" type="button" data-bs-target="#carousel<%= produto.cod_produto %>_<%= cod_cor %>" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true" style="filter: invert(27%) sepia(51%) saturate(2878%) hue-rotate(346deg) brightness(104%) contrast(97%);"></span>
                      </button>
                    </div>
                  <% else %>
                    <%= image_tag(imagens.first.imagem.variant(resize_to_limit: [220, 180]),
                          class: "rounded mx-auto d-block", 
                          style: "max-width: 220px; height: 180px; object-fit: contain; cursor: pointer;",
                          data: { images: imagens.map{|img| url_for(img.imagem)}.to_json.html_safe, index: 0 },
                          ondblclick: "openImageModal(this)" 
                        ) %>
                  <% end %>
                </div>
                <div class="card-body">
                  <h5 class="card-title">
                    <p class="card-text"><%= truncate(produto.titulo&.capitalize, length: 50) %></p>
                  </h5>
                  <div class="card-text">
                    <span id="desc-short-<%= produto.cod_produto %>_<%= cod_cor %>"><%= simple_format(truncate(produto.descricao&.capitalize, length: 100)) %></span>
                    <span id="desc-full-<%= produto.cod_produto %>_<%= cod_cor %>" style="display: none;"><%= simple_format(produto.descricao&.capitalize) %></span>
                    <% if produto.descricao&.length.to_i > 100 %>
                      <a href="#" class="text-primary" onclick="toggleDescription('<%= produto.cod_produto %>_<%= cod_cor %>')" id="toggle-<%= produto.cod_produto %>_<%= cod_cor %>">...mais</a>
                    <% end %>
                  </div>
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="text-success fw-bold">R$ <%= number_to_currency(produto.empresaprodutos.map(&:valor_site).compact.max, unit: "") %></span>
                    <% produto_url = produto_url(produto.cod_produto, cod_cor) %>
                    <button type="button" 
                          class="btn btn-primary" 
                          data-bs-toggle="modal" 
                          data-bs-target="#lojaModal<%= produto.cod_produto %>_<%= cod_cor %>"
                          data-produto-url="<%= produto_url %>">
                      Tenho interesse
                    </button>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <div class="col-12 text-center">
          <p>Nenhum produto disponível no momento.</p>
        </div>
      <% end %>
    </div>
  </div>
</section>
<!-- Modais dos produtos (renderizados para cada cor) -->
<% if @produtos.present? %>
  <% @produtos.each do |produto| %>
    <% produto.produto_imagens.group_by(&:cod_cor).each do |cod_cor, imagens| %>
      <%= render partial: 'whatsapp_modal', locals: { produto: produto, cod_cor: cod_cor } %>
    <% end %>
  <% end %>
<% end %>
<!-- Equipe Section -->
<section id="equipe" class="py-5">
  <div class="container">
    <h2 class="section-title text-center ">Fale Conosco</h2>
    <p class="text-center mb-5 ">Conheça os profissionais que fazem a diferença</p>
    <div class="row justify-content-center">
      <% if @colaboradores.present? %>
        <% @colaboradores.each do |colab| %>
          <div class="col-md-3 mb-4">
            <div class="card text-center h-100">
              <div class="p-3">
                <% if colab.photo.attached? %>
                  <%= image_tag url_for(colab.photo), class: "rounded-circle img-fluid mx-auto", style: "width: 150px; height: 150px; object-fit: cover;" %>
                <% else %>
                  <img src="/images/mrosa.png" class="rounded-circle img-fluid mx-auto" style="width: 150px; height: 150px; object-fit: cover;">
                <% end %>
              </div>
              <div class="card-body">
                <h5 class="card-title mb-1"><%= colab.display_name %></h5>
                <p class="text-muted mb-3"><%= colab.funcionario.funcao rescue "Atendimento" %></p>
                <div class="d-flex justify-content-center">
                  <% mensagem = "Olá " + colab.display_name&.capitalize + "! 👋 Tenho interesse em comprar um produto da sua loja. Pode me ajudar?" %>
                  <% url_whatsapp = "https://wa.me/#{colab.whatsapp_number.gsub(/\D/, "")}?text=#{URI.encode_www_form_component(mensagem)}" %>
                  <a href=<%= url_whatsapp %> class="btn btn-success btn-sm me-2" target="_blank">
                    <i class="fab fa-whatsapp me-1"></i> WhatsApp
                  </a>
                  <a href="mailto:<%= colab.email.present? ? colab.email : 'contato@moveisrosastore.com' %>" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-envelope me-1"></i> Email
                  </a>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="col-12 text-center">
          <p>Nenhum colaborador disponível no momento.</p>
        </div>
      <% end %>
    </div>
  </div>
</section>

<!-- Modal para ampliar imagem -->
<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center position-relative">
        <img id="modalImage" src="" class="img-fluid" style="max-width: 100%; height: auto;">
        <button id="prevBtn" class="btn btn-primary position-absolute top-50 start-0 translate-middle-y" onclick="changeImage(-1)" style="display: none;">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button id="nextBtn" class="btn btn-primary position-absolute top-50 end-0 translate-middle-y" onclick="changeImage(1)" style="display: none;">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
let currentImages = [];
let currentIndex = 0;

function openImageModal(element) {
  currentImages = JSON.parse(element.dataset.images);
  currentIndex = parseInt(element.dataset.index);
  document.getElementById('modalImage').src = currentImages[currentIndex];
  
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  
  if (currentImages.length > 1) {
    prevBtn.style.display = 'block';
    nextBtn.style.display = 'block';
  } else {
    prevBtn.style.display = 'none';
    nextBtn.style.display = 'none';
  }
  
  new bootstrap.Modal(document.getElementById('imageModal')).show();
}

function changeImage(direction) {
  currentIndex += direction;
  
  if (currentIndex < 0) {
    currentIndex = currentImages.length - 1;
  } else if (currentIndex >= currentImages.length) {
    currentIndex = 0;
  }
  
  document.getElementById('modalImage').src = currentImages[currentIndex];
}

function toggleDescription(id) {
  const shortDesc = document.getElementById('desc-short-' + id);
  const fullDesc = document.getElementById('desc-full-' + id);
  const toggle = document.getElementById('toggle-' + id);
  
  if (shortDesc.style.display === 'none') {
    shortDesc.style.display = 'inline';
    fullDesc.style.display = 'none';
    toggle.textContent = '...mais';
  } else {
    shortDesc.style.display = 'none';
    fullDesc.style.display = 'inline';
    toggle.textContent = ' menos';
  }
}
</script>